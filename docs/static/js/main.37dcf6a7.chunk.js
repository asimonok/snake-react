(this["webpackJsonpsnake-react"]=this["webpackJsonpsnake-react"]||[]).push([[0],{15:function(e,t,n){e.exports={root:"Game_root__J3Hd7",content:"Game_content__1cIbC",gameStep:"Game_gameStep__PDPM8",active:"Game_active__1YZ4z"}},21:function(e,t,n){e.exports={root:"Button_root__36fqZ",fluid:"Button_fluid__1uvKZ",large:"Button_large__1at-G"}},28:function(e,t,n){},3:function(e,t,n){e.exports={root:"GameProgress_root__1FMtp",gameAreaContainer:"GameProgress_gameAreaContainer__1qST6",gameArea:"GameProgress_gameArea__2Nc-d",scores:"GameProgress_scores__SJnTP",gameObject:"GameProgress_gameObject__EHgdi",gameControls:"GameProgress_gameControls__11UEy",gameControl:"GameProgress_gameControl__34QYC",pressed:"GameProgress_pressed__1cLgM",up:"GameProgress_up__nF36d",right:"GameProgress_right__2RIXf",left:"GameProgress_left__2_UI4",down:"GameProgress_down__1IGkr",gamePopup:"GameProgress_gamePopup__1hGzy",gamePopupContent:"GameProgress_gamePopupContent__1ILGk",pauseButton:"GameProgress_pauseButton__3PsJW"}},35:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(1),s=n.n(r),i=n(10),o=n.n(i),c=(n(28),n(4)),u=n(5),l="gameState",d=function(e){var t=e.getState;return function(e){return function(n){var a,r=e(n);return a=t(),localStorage.setItem(l,JSON.stringify({version:2,state:a})),r}}},h=n(8),m=n(2),f="notStarted",p="inProgress",g="finished",j="game/START_NEW",b="game/START_GAME",x="game/FINISH_GAME",_="game/SET_INFO",O="game/SAVE_GAME_RESULT",v={status:f,info:null,topResults:[]},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return Object(m.a)(Object(m.a)({},e),{},{status:p});case j:return Object(m.a)(Object(m.a)({},e),{},{status:f});case x:return Object(m.a)(Object(m.a)({},e),{},{status:g});case _:return Object(m.a)(Object(m.a)({},e),{},{info:t.payload.info});case O:var n=[].concat(Object(h.a)(e.topResults),[{username:t.payload.username,scores:e.info.scores}]);return n.sort((function(e,t){return t.scores-e.scores})),Object(m.a)(Object(m.a)({},e),{},{info:null,topResults:n});default:return e}},w="user/SET_USERNAME",y={username:null},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return Object(m.a)(Object(m.a)({},e),{},{username:t.payload.username});default:return e}},G=function(){var e=u.d,t=[d];return"function"===typeof window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&(e=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__),Object(u.e)(Object(u.c)({user:k,game:S}),function(){var e=JSON.parse(localStorage.getItem(l))||{version:2,state:{}};return 2===e.version?e.state:{}}(),e(u.a.apply(void 0,t)))}(),C=function(e){return e.game.status},P=function(e){return e.game.info},N=function(e){return e.game.topResults},R=n(6),E=n.n(R),D=n(11),T=n(12),M=n(14),I=n(13),z=n(22),L=n(21),F=E.a.bind(L),A=function(e){var t=e.children,n=(e.className,e.fluid),r=e.size,s=Object(z.a)(e,["children","className","fluid","size"]);return Object(a.jsx)("button",Object(m.a)(Object(m.a)({className:F("root",r,{fluid:n})},s),{},{children:t}))},U=n(9),B=function(e){Object(M.a)(n,e);var t=Object(I.a)(n);function n(){var e;Object(D.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={username:""},e.onChangeUsername=function(t){e.setState({username:t.target.value})},e.onStartGame=function(t){t.preventDefault(),e.props.setUsername(e.state.username),e.props.startGame()},e}return Object(T.a)(n,[{key:"render",value:function(){return Object(a.jsxs)("div",{className:U.root,children:[Object(a.jsx)("h1",{className:U.header,children:"Snake"}),Object(a.jsxs)("form",{className:U.form,onSubmit:this.onStartGame,children:[Object(a.jsx)("input",{type:"text",value:this.state.username,onChange:this.onChangeUsername,className:U.input,placeholder:"Username"}),Object(a.jsx)(A,{fluid:!0,size:"large",children:"Start"})]})]})}}]),n}(r.Component),H=Object(c.b)(null,{startGame:function(){return{type:b}},setUsername:function(e){return{type:w,payload:{username:e}}}})(B),J=function(e){return e.user.username},V="up",X="down",K="left",W="right",Z=15,q=30,Y=function(e,t){return Math.random()*(t-e)+e},Q=function(e){for(var t=0;t<e.length;t++)for(var n=t+1;n<e.length;n++)if(e[t].x===e[n].x&&e[t].y===e[n].y||e[t].x<=0||e[t].x>Z||e[t].y<=0||e[t].y>q)return!0;return!1},$=function(e,t){var n=e[0],a=n.x,r=n.y,s=a,i=r;return t===W&&(s=a+1),t===K&&(s=a-1),t===V&&(i=r-1),t===X&&(i=r+1),{x:s,y:i}},ee=function(e){for(var t=function(){var t=Math.round(Y(1,Z)),n=Math.round(Y(1,q));if(!e.some((function(e){var a=e.x,r=e.y;return a===t&&r===n})))return{v:{x:t,y:n}}};;){var n=t();if("object"===typeof n)return n.v}},te=function(e){var t=e.snake,n=e.fruit,a=e.direction,r=[$(t,a)].concat(Object(h.a)(t.slice(0,t.length-1))),s=n,i=0,o=r.length>=Z*q;return o||r[0].x!==n.x||r[0].y!==n.y||(r=[].concat(Object(h.a)(r),[t[t.length-1]]),s=ee(r),i=1),{isCrashed:o||Q(r),snake:r,fruit:s,scoresDiff:i}},ne=function(){var e=function(){for(var e=[],t=0;t<3;t++)e.push({x:Math.round(Z/2),y:Math.round(q/2)+t});return e}();return{snake:e,fruit:ee(e),scores:0,direction:V,isStarted:!1,isPlaying:!1,isEnded:!1}},ae=function(e,t){return e===K&&t===W||e===W&&t===K||e===V&&t===X||e===X&&t===V?e:t},re="snakeVertical",se="snakeHorizontal",ie="snakeCornerFromRightToDown",oe="snakeCornerFromRightToUp",ce="snakeCornerFromLeftToUp",ue="snakeCornerFromLeftToDown",le="snakeHeadLeft",de="snakeHeadRight",he="snakeHeadUp",me="snakeHeadDown",fe="snakeTailLeft",pe="snakeTailRight",ge="snakeTailUp",je="snakeTailDown",be="fruit",xe=n.p+"static/media/arrow-down.64f8221e.svg",_e=n.p+"static/media/arrow-up.8edaba49.svg",Oe=n.p+"static/media/arrow-right.d593d182.svg",ve=n.p+"static/media/arrow-left.c37d02d5.svg",Se=n.p+"static/media/pause.1a3d31f9.svg",we=n(3),ye=E.a.bind(we),ke=5,Ge=4,Ce=function(e){Object(M.a)(n,e);var t=Object(I.a)(n);function n(){var e;Object(D.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).areaContainerRef=null,e.state=Object(m.a)(Object(m.a)(Object(m.a)({sceneSize:{width:0,height:0}},ne()),e.props.gameInitialInfo),{},{isPlaying:!1,tempDirection:null,isShownMobileRotationMessage:!1}),e.calcStepTimer=null,e.onSetSceneSize=function(){var t=e.areaContainerRef.getBoundingClientRect(),n=t.width,a=t.height;console.log("onSetSceneSize",n,a),a>n?e.setState({sceneSize:{width:n,height:a},isShownMobileRotationMessage:!1}):(e.setState({isShownMobileRotationMessage:!0}),e.onPauseGame())},e.onStartGame=function(){e.state.isPlaying||(e.setState({isPlaying:!0,isStarted:!0}),e.calcStepTimer=setInterval((function(){var t=e.state,n=t.fruit,a=t.snake,r=t.direction,s=t.scores,i=t.tempDirection,o=i||r,c=te({snake:a,fruit:n,direction:o});c.isCrashed?e.onFinishGame():e.setState({fruit:c.fruit,snake:c.snake,scores:s+c.scoresDiff,direction:o,tempDirection:null},(function(){e.props.setGameInfo(e.state)}))}),150))},e.onRestartGame=function(){e.setState(Object(m.a)({},ne()),(function(){e.props.setGameInfo(e.state)}))},e.onPauseGame=function(){clearInterval(e.calcStepTimer),e.calcStepTimer=null,e.setState({isPlaying:!1},(function(){e.props.setGameInfo(e.state)}))},e.onFinishGame=function(){e.onPauseGame(),e.setState({isEnded:!0},(function(){e.props.setGameInfo(e.state),e.props.saveGameResult({username:e.props.username})}))},e.onKeyDown=function(t){var n=e.state.direction;switch(t.keyCode){case 37:n=K;break;case 38:n=V;break;case 39:n=W;break;case 40:n=X;break;default:n=e.state.direction}e.onChangeDirection(n)},e.onChangeDirection=function(t){e.state.isPlaying&&e.setState({tempDirection:ae(e.state.direction,t)})},e.onSwipe=function(t){var n=e.state.direction;switch(t.direction){case 2:n=K;break;case 8:n=V;break;case 4:n=W;break;case 16:n=X;break;default:n=e.state.direction}e.onChangeDirection(n)},e.onGoToResults=function(){e.props.finishGame(),e.onRestartGame()},e}return Object(T.a)(n,[{key:"componentDidMount",value:function(){this.onSetSceneSize(),window.addEventListener("resize",this.onSetSceneSize),window.addEventListener("orientationchange",this.onSetSceneSize),document.addEventListener("keydown",this.onKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onSetSceneSize),window.removeEventListener("orientationchange",this.onSetSceneSize),document.removeEventListener("keydown",this.onKeyDown)}},{key:"render",value:function(){var e=this,t=this.state,r=t.sceneSize,i=t.snake,o=t.fruit,c=t.scores,u=t.direction,l=t.tempDirection,d=t.isPlaying,h=t.isEnded,m=t.isStarted,f=t.isShownMobileRotationMessage,p={width:Math.round(r.width/Z),height:Math.round(r.height/q)},g=function(e){var t=e.snake,n=e.direction,a=void 0===n?V:n;return t.map((function(e,n){var r=e.x,s=e.y;if(0===n){if(a===K)return le;if(a===W)return de;if(a===V)return he;if(a===X)return me}if(n===t.length-1){if(1===r||r===Z){if(r===Z&&1===t[n-1].x)return pe;if(1===r&&t[n-1].x===Z)return fe}if(1===s||s===q){if(s===q&&1===t[n-1].y)return je;if(1===s&&t[n-1].y===q)return ge}return t[n-1].x>r?pe:t[n-1].x<r?fe:t[n-1].y<s?ge:je}if(t[n-1].x===r){if(t[n+1].x>r){if(t[n-1].y<s)return oe;if(t[n-1].y>s)return ie}if(t[n+1].x<r){if(t[n-1].y<s)return ce;if(t[n-1].y>s)return ue}return re}if(t[n-1].y===s){if(t[n+1].y>s){if(t[n-1].x<r)return ue;if(t[n-1].x>r)return ie}if(t[n+1].y<s){if(t[n-1].x<r)return ce;if(t[n-1].x>r)return oe}return se}return""}))}({snake:i,direction:u});return Object(a.jsxs)("div",{className:we.root,children:[Object(a.jsx)("div",{className:we.gameAreaContainer,ref:function(t){e.areaContainerRef=t},children:Object(a.jsxs)("div",{className:we.gameArea,style:{width:r.width,height:r.height},children:[i.map((function(e,t){var r=e.x,s=e.y;return Object(a.jsx)("span",{className:ye("gameObject",we.snake,{head:0===t}),style:{transform:"translate(".concat(p.width*(r-1),"px, ").concat(p.height*(s-1),"px)"),width:p.width,height:p.height,backgroundSize:"".concat(p.width*ke,"px ").concat(p.height*Ge,"px"),backgroundPosition:n.getSpritePositionByPart(g[t],p)}},t)})),Object(a.jsx)("span",{className:ye("gameObject","fruit"),style:{transform:"translate(".concat(p.width*(o.x-1),"px, ").concat(p.height*(o.y-1),"px)"),width:p.width,height:p.height,backgroundSize:"".concat(p.width*ke,"px ").concat(p.height*Ge,"px"),backgroundPosition:n.getSpritePositionByPart(be,p)}}),Object(a.jsxs)("div",{className:we.scores,children:["Scores: ",c]}),Object(a.jsx)("button",{className:we.pauseButton,onClick:this.onPauseGame,children:Object(a.jsx)("img",{src:Se,alt:"",width:24,height:24})}),Object(a.jsxs)("div",{className:we.gameControls,children:[Object(a.jsx)("button",{className:ye("gameControl","up",{pressed:l===V}),onClick:function(){return e.onChangeDirection(V)},children:Object(a.jsx)("img",{src:_e,alt:""})}),Object(a.jsx)("button",{className:ye("gameControl","right",{pressed:l===W}),onClick:function(){return e.onChangeDirection(W)},children:Object(a.jsx)("img",{src:Oe,alt:""})}),Object(a.jsx)("button",{className:ye("gameControl","down",{pressed:l===X}),onClick:function(){return e.onChangeDirection(X)},children:Object(a.jsx)("img",{src:xe,alt:""})}),Object(a.jsx)("button",{className:ye("gameControl","left",{pressed:l===K}),onClick:function(){return e.onChangeDirection(K)},children:Object(a.jsx)("img",{src:ve,alt:""})})]})]})}),f&&Object(a.jsx)("div",{className:we.gamePopup,children:Object(a.jsx)("div",{className:we.gamePopupContent,children:Object(a.jsx)("h2",{children:"Please rotate phone vertically"})})}),!d&&!f&&Object(a.jsx)("div",{className:we.gamePopup,children:Object(a.jsxs)("div",{className:we.gamePopupContent,children:[h&&Object(a.jsxs)(s.a.Fragment,{children:[Object(a.jsx)("h2",{children:"Game over"}),Object(a.jsxs)("div",{children:["Your scores: ",c]}),Object(a.jsx)(A,{onClick:this.onRestartGame,children:"Restart"}),Object(a.jsx)("br",{}),Object(a.jsx)(A,{onClick:this.onGoToResults,children:"View top results"})]}),m&&!h&&Object(a.jsxs)(s.a.Fragment,{children:[Object(a.jsx)("h2",{children:"Paused"}),Object(a.jsx)(A,{onClick:this.onStartGame,children:"Return to game"})]}),!m&&Object(a.jsxs)(s.a.Fragment,{children:[Object(a.jsx)("h2",{children:"Prepare to game"}),Object(a.jsx)(A,{onClick:this.onStartGame,children:"I'm ready!"})]})]})})]})}}],[{key:"getSpritePositionByPart",value:function(e,t){return e===re?"-".concat(2*t.width,"px -").concat(t.height,"px"):e===se?"-".concat(t.width,"px 0px"):e===he?"-".concat(3*t.width,"px 0px"):e===me?"-".concat(4*t.width,"px -").concat(t.height,"px"):e===de?"-".concat(4*t.width,"px 0px"):e===le?"-".concat(3*t.width,"px -").concat(t.height,"px"):e===ue?"-".concat(2*t.width,"px 0px"):e===ce?"-".concat(2*t.width,"px -").concat(2*t.height,"px"):e===oe?"0px -".concat(t.height,"px"):e===ie?"0px 0px":e===je?"-".concat(4*t.width,"px -").concat(3*t.height,"px"):e===ge?"-".concat(3*t.width,"px -").concat(2*t.height,"px"):e===fe?"-".concat(3*t.width,"px -").concat(3*t.height,"px"):e===pe?"-".concat(4*t.width,"px -").concat(2*t.height,"px"):e===be?"0px -".concat(3*t.height,"px"):void 0}}]),n}(r.Component),Pe=Object(c.b)((function(e){return{gameInitialInfo:P(e),username:J(e)}}),{finishGame:function(){return{type:x}},setGameInfo:function(e){return{type:_,payload:{info:e}}},saveGameResult:function(e){var t=e.username;return{type:O,payload:{username:t}}}})(Ce),Ne=n(7),Re=function(e){var t=e.results,n=e.startNew;return Object(a.jsxs)("div",{className:Ne.root,children:[Object(a.jsx)("h1",{children:"Results"}),Object(a.jsx)(A,{onClick:n,children:"Start new game"}),Object(a.jsx)("ul",{className:Ne.list,children:t.map((function(e,t){var n=e.username,r=e.scores;return Object(a.jsxs)("li",{children:[Object(a.jsxs)("span",{children:[Object(a.jsxs)("span",{className:Ne.place,children:["#",t+1]}),Object(a.jsx)("span",{className:Ne.username,children:n||"[NO_NAME]"})]}),Object(a.jsx)("span",{className:Ne.scores,children:r})]},t)}))})]})},Ee=Object(c.b)((function(e){return{results:N(e)}}),{startNew:function(){return{type:j}}})(Re),De=n(15),Te=E.a.bind(De),Me=function(e){var t=e.gameStatus;return Object(a.jsx)("div",{className:De.root,children:Object(a.jsxs)("div",{className:De.content,children:[Object(a.jsx)("div",{className:Te("gameStep",{active:t===f}),children:Object(a.jsx)(H,{})}),Object(a.jsx)("div",{className:Te("gameStep",{active:t===p}),children:Object(a.jsx)(Pe,{})}),Object(a.jsx)("div",{className:Te("gameStep",{active:t===g}),children:Object(a.jsx)(Ee,{})})]})})},Ie=Object(c.b)((function(e){return{gameStatus:C(e)}}),null)(Me),ze=(n(35),function(){return Object(a.jsx)(c.a,{store:G,children:Object(a.jsx)(Ie,{})})}),Le=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),s(e),i(e)}))};o.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(ze,{})}),document.getElementById("root")),Le()},7:function(e,t,n){e.exports={root:"Results_root__3GeLc",list:"Results_list__1-Wbn",place:"Results_place__1RgJZ",username:"Results_username__cMduw",scores:"Results_scores__1xqu6"}},9:function(e,t,n){e.exports={root:"GameStart_root__32D5t",header:"GameStart_header__19PxQ",form:"GameStart_form__srtCD",input:"GameStart_input__3drHp"}}},[[36,1,2]]]);
//# sourceMappingURL=main.37dcf6a7.chunk.js.map